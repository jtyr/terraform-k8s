name: On PR

on:
  pull_request:
    branches:
      - main

permissions:
  contents: read

jobs:
  build:
    name: Test build
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.18

      - name: Install kubebuilder
        run: |
          curl -Ls https://github.com/kubernetes-sigs/kubebuilder/releases/download/v2.3.1/kubebuilder_2.3.1_linux_amd64.tar.gz |
          tar -C /tmp -zxf -

      - name: Run GoReleaser
        uses: goreleaser/goreleaser-action@v2
        with:
          args: release --snapshot --skip-publish --rm-dist --skip-sign
        env:
          KUBEBUILDER_ASSETS: /tmp/kubebuilder_2.3.1_linux_amd64/bin
